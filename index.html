<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Projekt zaliczeniowy - Bruno Talaga</title>
</head>
<body>
    <h2>Projekt zaliczeniowy - Bruno Talaga</h2>
    <div id="variable_table" class="default_segment">
        <p>Tabela wartości</p>
        <table class="default_table">
            <tr><th>AX</th><th>BX</th><th>CX</th><th>DX</th></tr>
            <tr>
                <td id="ax_val"></td>
                <td id="bx_val"></td>
                <td id="cx_val"></td>
                <td id="dx_val"></td>
            </tr>
        </table>
        <button type="button" name="empty_table" id="empty_first" value="Wyzeruj" onclick="emptyTable(0)">Wyzeruj</button>
        <button type="button" name="randomize_table" id="randomize_first" value="Wypełnij losowo" onclick="randomizeTable(0)">Wypełnij losowo</button>
        <table class="default_table">
            <tr><th>BP</th><th>DI</th><th>SI</th><th>DISP</th>
            </tr>
            <tr>
                <td id="bp_val"></td>
                <td id="di_val"></td>
                <td id="si_val"></td>
                <td id="offset_val"></td>
            </tr>
        </table>
        <button type="button" name="empty_table" id="empty_second" value="Wyzeruj" onclick="emptyTable(1)">Wyzeruj</button>
    </div>
    <div id="operations" class="default_segment">
        <p>Pole komend</p>
        <select name="commands" id="commands">
            <option value="MOV">MOV</option>
            <option value="XCHG">XCHG</option>
            <option value="PUSH">PUSH</option>
            <option value="POP">POP</option>
        </select>
        <input type="text" name="arg_first" id="arg_first">,
        <input type="text" name="arg_second" id="arg_second">
        <button type="button" name="run_command" id="run_command" value="Wykonaj" onclick="runCommand(document.getElementById(`commands`).value, document.getElementById(`arg_first`).value, document.getElementById(`arg_second`).value)">Wykonaj</button><br>
    </div>
    <div id="log" class="default_segment">
        <p id="status_message">Log operacji: </p><span id="operation_return"></span>
    </div>
    <script>
        vars = ["AX", "BX", "CX", "DX", "BP", "DI", "SI", "DISP"];
        hexRegex = /^[0-9a-fA-F]{1,4}$/;
        function setOperationMessage(message){
            document.getElementById("operation_return").innerHTML += message + "<br>";
        }
        function updateGUI(){
            document.getElementById("ax_val").innerHTML = vars["AX"];
            document.getElementById("bx_val").innerHTML = vars["BX"];
            document.getElementById("cx_val").innerHTML = vars["CX"];
            document.getElementById("dx_val").innerHTML = vars["DX"];
            document.getElementById("bp_val").innerHTML = vars["BP"];
            document.getElementById("di_val").innerHTML = vars["DI"];
            document.getElementById("si_val").innerHTML = vars["SI"];
            document.getElementById("offset_val").innerHTML = vars["DISP"];
        }
        function runCommand(operation, argFirst, argSecond) {
            let present = false;
            let invalidArg = argFirst;
            vars.every(varName => {
                if (varName == argFirst) {
                    if (operation == "MOV") {
                        vars[`${argFirst}`] = typeof (vars[`${argSecond}`]) !== "undefined" ? vars[`${argSecond}`] : hexRegex.test(argSecond) ? argSecond : "0000";
                    }
                    else if (operation == "XCHG") {
                        if (typeof (vars[`${argSecond}`]) === "undefined") {
                            invalidArg = argSecond;
                            return false;
                        }
                        let temp = vars[`${argFirst}`];
                        vars[`${argFirst}`] = vars[`${argSecond}`];
                        vars[`${argSecond}`] = temp;
                    }
                    setOperationMessage(`${operation} ${argFirst}, ${typeof (vars[`${argSecond}`]) !== "undefined" ? argSecond : hexRegex.test(argSecond) ? argSecond : "0000"}`);
                    updateGUI();
                    present = true;
                    return false;
                }
                return true;
            });
            if (!present) setOperationMessage(`INVALID ARGUMENT \"${invalidArg}\"`);
        }
        function emptyTable(tableId) {
            for (let i = tableId * 4; i < tableId * 4 + 4; i++) {
                runCommand("MOV", `${vars[i]}`, "0000");
            }
        }
        function randomizeTable(tableId) {
            for (let i = tableId * 4; i < tableId * 4 + 4; i++) {
                runCommand("MOV", `${vars[i]}`, Math.floor(Math.random() * 65535).toString(16).padStart(4, '0'));
            }
        }
        console.log(vars);
        emptyTable(0);
        emptyTable(1);
        updateGUI();
    </script>
</body>
</html>